# SKN10-4th-3Team

# 0. 팀 소개
  ### 팀명: 3팀 

<br>

### 팀원 소개
<table align="center" width="100%">
  <tr>
    <td align="center"><b>팀장</b></td>
    <td align="center" colspan="4"><b>팀원</b></td>
  </tr>
  <tr>
    <td align="center">원유형</td>
    <td align="center">김현수</td>
    <td align="center">이서영</td>
    <td align="center">정소열</td>
    <td align="center">최수헌</td>
  </tr>
  <tr>
    <td align="center"><img src="https://github.com/user-attachments/assets/b9c193d8-9fe5-442f-97db-617f53188438" width="175px" height="150px"/></td>
    <td align="center"><img src="https://github.com/user-attachments/assets/ab8e5995-0f51-4039-a019-f2fab629aa57" width="175" height="150"></td>
    <td align="center"><img src="https://github.com/user-attachments/assets/2f93fe6e-07cd-43da-b3c9-203ddb91f4bd" width="175" height="150"></td>
    <td align="center"><img src="https://github.com/user-attachments/assets/a3ee8f49-fe94-477d-920a-ec193ee999c8" width="175" height="150"></td>
    <td align="center"><img src="https://github.com/user-attachments/assets/e93dfa9a-55fa-4495-a2d6-ffc98dc2cc09" width="175" height="150"></td>
  </tr>
  <tr>
    <td align="center"><a href="https://github.com/user-attachments/assets/87d06e7e-3850-4082-b29e-557128509e38"><b>@원유형</b></a></td>
    <td align="center"><a href="https://github.com/user-attachments/assets/87d06e7e-3850-4082-b29e-557128509e38"><b>@김현수</b></a></td>
    <td align="center"><a href="https://github.com/user-attachments/assets/87d06e7e-3850-4082-b29e-557128509e38"><b>@이서영</b></a></td>
    <td align="center"><a href="https://github.com/user-attachments/assets/87d06e7e-3850-4082-b29e-557128509e38"><b>@정소열</b></a></td>
    <td align="center"><a href="https://github.com/user-attachments/assets/87d06e7e-3850-4082-b29e-557128509e38"><b>@최수헌</b></a></td>
  </tr>
</table>

<br>

# 1. 프로젝트 개요

### 프로젝트 명
- 철학 고민 상담 챗봇

### 프로젝트 목적
- 본 프로젝트는 “내가 누구인지”, “왜 힘든지”, “어떻게 살아야 하는지”를 고민하는 사용자에게, 철학자들의 문장과 사유를 기반으로 대화를 제공함으로써, 단순한 감정 위로를 넘어 스스로 답을 찾아가게 돕는 철학적 AI 챗봇을 개발하고자 함.

### 프로젝트 소개 및 목표
- **소개**: 고민을 이야기하면 철학자의 문장으로 응답하는 감성 대화 챗봇.
고대부터 현대에 이르기까지 다양한 철학자의 사유를 통해, 사용자가 스스로 성찰하고 마음을 정리할 수 있는 계기를 제공.
<br>

- **프로젝트 목표**: <br> <t>1. 고민과 감정에 철학적으로 접근하는 경험을 사용자에게 제공 <br>
<t>2. 즉각적이고 비심판적인 대화 상대로서 정서적 위로와 사색의 기회를 제공</t><br><t>3. 철학을 일상 언어로 재해석하여 철학에 대한 진입 장벽을 낮춤</t>
 </t>

<br>

 # 2. 기술 스택
<br/>

| **Frontend** | **Backend** | **Embedding model** | **LLM Model** | **Vector DB** | **Deployment** | **Collaboration Tool** |
|--------------|-------------|-------------------|----------------|----------------|----------------|----------------------|
| ![HTML](https://img.shields.io/badge/-HTML5-E34F26?logo=html5&logoColor=white)<br>![CSS](https://img.shields.io/badge/-CSS3-1572B6?logo=css3&logoColor=white)<br>![JavaScript](https://img.shields.io/badge/-JavaScript-F7DF1E?logo=javascript&logoColor=black) | ![Django](https://img.shields.io/badge/-Django-092E20?logo=django&logoColor=white)<br>|![openai](https://img.shields.io/badge/-openai-412991?logo=openai&logoColor=white) |![googlegemini](https://img.shields.io/badge/-googlegemini-8E75B2?logo=googlegemini&logoColor=white)<br> | ![postgresql](https://img.shields.io/badge/-postgresql-4169E1?logo=postgresql&logoColor=white) | ![Docker](https://img.shields.io/badge/-Docker-2496ED?logo=docker&logoColor=white)<br>![AWS EC2](https://img.shields.io/badge/-AWS%20EC2-FF9900?logo=amazonaws&logoColor=white) | ![Git](https://img.shields.io/badge/-Git-F05032?logo=git&logoColor=white)<br>![GitHub](https://img.shields.io/badge/-GitHub-181717?logo=github&logoColor=white)<br>![Discord](https://img.shields.io/badge/-Discord-5865F2?logo=discord&logoColor=white) |

<br>

 # 3. 시스템 아키텍처

## Web
 ![Image](https://github.com/user-attachments/assets/1effbd2d-d64c-48e3-8238-a9f305d825d1)
 <br>

## ERD
 ![Image](https://github.com/user-attachments/assets/99c147be-ce3e-4025-9713-9f72d3fa8240)
<br>

 ## Account
 ![Image](https://github.com/user-attachments/assets/b7243fae-911a-4dbb-b60a-30aff45cee43)
 <br>

 ## Chatbot
  ![Image](https://github.com/user-attachments/assets/16069f28-5804-4b58-bfc2-990d34bc2ed5)
 <br>

 ## AWS
![Image](https://github.com/user-attachments/assets/d74224dc-b21d-4e02-a69a-7184f48b5574)




<br>

 # 4. 프로젝트 진행 과정
 ## 📦 데이터 수집 및 전처리 프로세스

### 🔹 1. 원본 데이터

- **출처**: [philosopher_quotes.csv](https://huggingface.co/datasets/datastax/philosopher-quotes)  
- **설명**: 유명 철학자들의 인용문이 수록된 공개 데이터셋

---

### 🔹 2. 데이터베이스

- **DBMS**: PostgreSQL  
- **테이블**: `philosophydata`  
- **주요 컬럼**:
  - `author`: 철학자
  - `quote`: 철학자 인용문
  - `quote_emb`: 인용문 임베딩 (OpenAI)
  - `keywords`: 추출된 키워드
  - `keywords_emb`: 키워드 임베딩 (OpenAI)

---

### 🔹 3. 사용자 입력 텍스트 임베딩

- **모델**: `OpenAI - text-embedding-3-small`
- **설명**: 사용자 입력 텍스트에 대한 임베딩 벡터를 추출
- **저장 위치**: `philosophydata` 테이블의 `quote_emb` 컬럼

---

### 🔹 4. 키워드 추출 및 임베딩

- **키워드 추출**: `Gemini - models/gemini-2.0-flash` 사용  
  → 사용자 입력으로부터 핵심 키워드 5개 추출  
- **임베딩 모델**: `OpenAI - text-embedding-3-small`  
  → 추출된 키워드에 대한 임베딩 생성  
- **저장 위치**: `philosophydata` 테이블의 `keywords_emb` 컬럼
<br><br>

 ### 3. RAG 벡터 검색 구축 및 챗봇 생성
## 🔍 RAG 및 벡터 검색 시스템

사용자 입력으로부터 철학적 인용문을 연관 검색하고, LLM을 통해 답변을 생성하는 **RAG(Retrieval-Augmented Generation)** 구조입니다.

---

### ✅ Step 1: 사용자 입력 수집

- 사용자가 질문 또는 텍스트를 입력합니다.

---

### ✅ Step 2: 전처리

1. **키워드 추출**
   - Gemini(`models/gemini-2.0-flash`)를 사용해 입력 문장에서 핵심 키워드 5개를 추출합니다.
2. **입력 문장 번역 및 임베딩**
   - 사용자 입력을 영어로 번역한 뒤, OpenAI의 `text-embedding-3-small` 모델을 사용해 임베딩을 생성합니다.
3. **키워드 임베딩**
   - 추출된 각 키워드에 대해서도 동일한 임베딩 모델로 벡터를 생성합니다.

---

### ✅ Step 3: 벡터 유사도 기반 검색

1. **키워드 기반 검색**
   - `keywords_emb` 필드를 기준으로 전체 DB(`philosophydata`)에서 코사인 유사도를 계산합니다.
   - 유사도가 높은 상위 10개의 인용문을 검색합니다.

2. **문장 기반 검색**
   - `quote_emb` 필드를 기준으로 번역된 입력 임베딩과 전체 인용문 임베딩 간 유사도를 계산합니다.
   - **키워드 기반 검색**으로 뽑은 상위 10개의 인용문 중 **문장 기반 검색**유사도가 높은 상위 3개를 ReRank합니다.

---

### ✅ Step 4: LLM을 통한 답변 생성

- 최종적으로 수집한 3개의 인용문들을 **retriever** 입력으로 Gemini 모델에 전달합니다.
- 사용자 질문에 대한 철학적이고 깊이 있는 응답을 생성합니다.

 ### 4. JWT를 사용한 로그인 및 회원가입

1. **account 페이지 접근 요청** 시 사용자의 **로그인 상태 확인**

   * 로그인되어 있으면 → `Chatbot 페이지`로 이동
   * 로그인되어 있지 않으면 → 로그인 또는 회원가입 절차로 이동

2. **회원가입 프로세스**

   * `회원가입 페이지` 진입
   * 사용자로부터 `회원정보 입력` 받음
   * `회원정보 중복 확인`

     * 회원정보 중복일 경우 → 다시 정보 입력 요청
     * 회원정보 중복이 아닐 경우 → `회원가입 완료`

3. **로그인 프로세스**

   * `로그인 페이지` 진입
   * 사용자로부터 `로그인 정보 입력` 받음
   * 입력값 `오입력 확인`

     * 로그인 정보가 올바르면 → `JWT 토큰 발급`
     * 로그인 정보가 틀리면 → 다시 입력 요청
   * 로그인 후 `Chatbot 페이지`에 접근 가능

4. **로그아웃 프로세스**

   * 사용자 요청 시 `로그아웃 수행`
   * JWT 토큰 제거

 ### 5. AWS 설정 
![Image](https://github.com/user-attachments/assets/fecb7283-605a-4c9b-9d52-03aa7ecf8d09)



 <br>

 # 5. 시연
 http://13.209.5.12/chatbot/
 
<br>

# 6. 이슈 및 해결방법
### 1. migrations폴더 안에 있는 0001_initial.py가 gitignore에 적용되지 않는 문제 해결
<br/>

**문제**
<br/>

.gitignore에 migrations/를 넣었는데 migrations폴더 안에 있는 0001_initial.py가 gitignore에 적용되지 않았습니다. 
<br/>

**해결**
<br/>

 0001_initial.py파일이 이미 커밋 돼서 깃이 추적 중이기 때문에 무시되지 않는 것이었습니다. 따라서 Git에게 해당 폴더 추적 중단 요청을 하고 다시 진행을 하니 잘 적용이 되는 걸 볼 수 있었습니다.
<br/>

### 2. chatbot 페이지에서의 유저 인증 문제
<br/>

**문제**
<br/>

jwt 을 이용해 로그인 을 함으로써 request.user로 인증이 불가능해졌습니다.
<br/>

**해결**
<br/>

access_token을 get하고 decode를 하여 chatbot 페이지에서 user의 정보를 불러올 수 있었습니다.
<br/>

### 3. github과 aws connection 실패
<br/>

**문제**
<br/>

SKN 계정에 aws connection 하는 권한이 없는 문제가 발생했습니다.
<br/>

**해결**
<br/>

개인 계정에 코드를 가져와서 aws에 연결하여 ci/cd 를 구축함으로 문제를 해결하였습니다.
<br/>

### 4. JS 적용 문제
<br/>

**문제**
<br/>

JS 적용 과정에서 문제가 발생하였습니다.
<br/>

**해결**
<br/>

캐시를 지우니 제대로 적용이 되었습니다.
<br/>

<br>

# 7.한 줄 회고

**원유형**
<br/>

팀원들이 각자 맡은 바를 열정적으로 수행해주어서 큰 문제 없이 프로젝트를 할 수 있었습니다.  django 을 활용한 웹 기능을 여러 개 구현하면서 django에 대해 더 이해할 수 있었습니다.
<br/>

**김현수**
<br/>

웹이나 인증/인가에 대한 지식이 부족한 상태로 구현하다보니 시간을 오래 할애했지만 구현해볼 수 있어서 좋았고 같이 프로젝트를 마친 팀원분들과 팀장님 감사합니다.
<br/>

**이서영**
<br/>

장고 프레임워크를 전반적으로 경험할 수 있는 좋은 시간이었습니다. 팀원분들 덕분에 무사히 프로젝트를 마칠 수 있었습니다. 다시한번 감사드립니다.
<br/>

**정소열**
<br/>

프로젝트를 통해서 배운 걸 적용하고 복기하는 경험이 되었습니다. 친절하게 도와주신 팀원분들 팀장님 감사합니다.
<br/>

**최수헌**
<br/>

AWS 배포까지 성공하게 되어 뿌듯했고, 끝까지 함께해준 팀원들에게 정말 감사합니다. 다소 낯선? 주제였음에도 열린 마음으로 받아들여준 팀원분들 고생하셨습니다!
<br/>
